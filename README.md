Исходники сайта [ybpsvf.ru](http://ybpsvf.ru/).

Написано на Apache/PHP/MySQL потому что только на них есть хостинги за 10 рублей в месяц.

### Установка

1. Скачать депенденси (которая щас одна) с помощью скрипта composer. Вводите в этой папке `php composer.phar install` и всё.

2. Переименовать `config.inc.example.php` в `config.inc.php` и вписать туда свои настройки.

3. Загрузить дамп базы данных из файла `db_structure.sql`.

### Использование

Для обновления сайта нужно регулярно запрашивать `/update_data.php?secret=<бэ>&method=<мэ>`, где `<бэ>` — значение переменной `$CONFIG['SECRET']` из файла `config.inc.php`, `<мэ>` — имя одной из следующих команд:

`update_regular`: скрипт загружает сегодняшний список фильмов, список последних оценок, качает постеры, обновляет диаграммы и генерирует новый `index.html`.

`update_collages`: генерируются коллажи из постеров сегодняшних фильмов. За один запрос генерируется один коллаж из устаревших. Условие устаревшести коллажа: `filemtime(<файлнейм коллажа>) < filemtime("index.html")`

`update_ratings`: для фильмов обновляются рейтинги Кинопоиска. Назначение этого функционала состоит в том, что часто при выходе фильма его рейтинг не отображается, и его нужно потом подтянуть. Если задан GET-параметр `portion`, то загружается 5 штук начиная с `5 * $portion` в порядке возрастания значения поля `id`.

`update_a_poster`: обновляет jpg-файл с постером для определенного фильма, заданного GET-параметром `kinopoisk_url`, который идентифицирует фильм по значению поля `kinopoisk_url` в базе данных. Это нужно для того, что иногда при выходе фильма у него постер нерусский или вообще хуй знает какой, с помощью этой команды его можно потом обновить.

Некоторые команды можно запускать без параметра `secret`. Метод `update_regular` можно запускать раз 6 часов (когда `time() - filemtime("index.html") >= 6 * 60 * 60`), `update_collages` — всегда (работать он будет только при наличии устаревших коллажей).

### По поводу времени выполнения

Обратите внимание, что в дни, когда вышло много новых фильмов, на обновление информации может потребоваться примерно $Dohooya$ секунд. Если на вашем хостинге max_execution_time стоит 30 секунд (а на хостингах за 10 рублей в месяц он такой и стоит), скрипт может не успеть (и не успеет!) выполниться.

В таких случаях его можно запускать несколько раз - ничего страшного не произойдет.


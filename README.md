Исходники сайта [ybpsvf.ru](http://ybpsvf.ru/).

Написано на Apache/PHP/MySQL потому что только на них есть хостинги за 10 рублей в месяц.

### Установка

1. Скачать депенденси (которая щас одна) с помощью скрипта composer. Вводите в этой папке `php composer.phar install` и всё.

2. Переименовать `config.inc.example.php` в `config.inc.php` и вписать туда свои настройки.

3. Загрузить дамп базы данных из файла `db_structure.sql`.

### Использование

Для обновления сайта нужно регулярно запрашивать `/update_data.php?secret=<бэ>&method=<мэ>`, где `<бэ>` — значение переменной `$CONFIG['SECRET']` из файла `config.inc.php`, `<мэ>` — одно из следующих значений:

`update_regular`: скрипт загружает сегодняшний список фильмов, список последних оценок, качает постеры, обновляет диаграммы и генерирует новый `index.html`.

`update_collages`: генерируются коллажи из постеров сегодняшних фильмов. Дополнительный GET-параметр `which_collages`, которому присваивается строка из девяти нулей и единиц, определяет, какие именно коллажи делать. Если параметр не задан, делаются все (на что на вашем хостинге может не хватить времени, см. ниже).

`update_ratings`: для фильмов обновляются рейтинги Кинопоиска. Назначение этого функционала состоит в том, что часто при выходе фильма его рейтинг не отображается, и его нужно потом подтянуть. Если задан GET-параметр `portion`, то загружается 10 штук начиная с `10 * $portion` в порядке возрастания значения поля `id`.

`update_a_poster`: обновляет jpg-файл с постером для определенного фильма, заданного GET-параметром `kinopoisk_url`, который идентифицирует фильм по значению поля `kinopoisk_url` в базе данных. Это нужно для того, что иногда при выходе фильма у него постер нерусский или вообще хуй знает какой, с помощью этого метода его можно потом обновить.

### По поводу времени выполнения

Обратите внимание, что в дни, когда вышло много новых фильмов, на обновление информации может потребоваться примерно $Dohooya$ секунд. Если на вашем хостинге max_execution_time стоит 30 секунд (а на хостингах за 10 рублей в месяц он такой и стоит), скрипт может не успеть (и не успеет!) выполниться.

В таких случаях его можно запускать несколько раз - ничего страшного не произойдет.

